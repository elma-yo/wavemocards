<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- 手機版網頁 CSS Reset 螢幕解析度 Reset -->
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
    <title>浪潮情緒卡｜找尋我的情緒｜我的情緒故事-背景篇</title>
    <!-- Bootstrap icon -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- Bootstrap css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  </head>
  <body>
    <div class="" id="top"></div>
    <%- include('./layout/headerLoggedInNoFixed'); -%>

    <main>
        <div class="sticky-top pb-8 bg-white">
            <div class="container">
                <!-- process bar -->
                <div class="d-flex mb-20 pt-20 justify-content-center justify-content-sm-end">
                    <div class="progressBar mb-8 px-12">
                        <div class="position-relative m-4">
                            <div class="progress bg-gray-300" style="height: 2px;">
                                <div class="progress-bar bg-main-tint01" role="progressbar" style="width: 40%;" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <a class="p-num position-absolute top-0 start-0 translate-middle btn btn-sm btn-main-tint01 rounded-pill d-flex justify-content-center align-items-center" id="tooltip" href="myEmoCardsHolder.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="我的情緒卡夾">
                                <span class="d-block" style="cursor: pointer;">1</span>
                            </a>
                            <a class="p-num position-absolute top-0 start-20 translate-middle btn btn-sm btn-main-tint01 rounded-pill d-flex justify-content-center align-items-center" id="tooltip" href="myEmoCardsHolder.html" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1st情緒強度">
                                <span class="d-block" style="cursor: pointer;">2</span>
                            </a>
                            <div class="p-num position-absolute top-0 start-40 translate-middle btn btn-sm btn-outline-main-tint01 border-2 rounded-pill d-flex justify-content-center align-items-center" data-bs-toggle="tooltip" data-bs-placement="bottom" title="背景篇">
                                <span class="d-block">3</span>
                            </div>
                            <div class="p-num position-absolute top-0 start-60 translate-middle btn btn-sm btn-outline-gray-450 rounded-pill d-flex justify-content-center align-items-center" data-bs-toggle="tooltip" data-bs-placement="bottom" title="行動篇">
                                <span class="d-block">4</span>
                            </div>
                            <div class="p-num position-absolute top-0 start-80 translate-middle btn btn-sm btn-outline-gray-450 rounded-pill d-flex justify-content-center align-items-center" data-bs-toggle="tooltip" data-bs-placement="bottom" title="2nd情緒強度">
                                <span class="d-block">5</span>
                            </div>
                            <div class="p-num position-absolute top-0 start-100 translate-middle btn btn-sm btn-outline-gray-450 rounded-pill d-flex justify-content-center align-items-center" data-bs-toggle="tooltip" data-bs-placement="bottom" title="感謝自我">
                                <span class="d-block">6</span>
                            </div>
                        </div>
                    </div>
                </div>
    
                <!-- title bar -->
                <div class="pb-8 px-12 px-sm-0 border-2 border-bottom border-main-tint02 d-flex justify-content-between align-items-center">
                    <h2 class="fs-3 d-none d-md-block">我的情緒故事｜背景篇</h2>
                    <h2 class="fs-3 d-md-none d-flex flex-column">
                        <span class="d-block">我的情緒故事</span>
                        <span>背景篇</span>
                    </h2>
                    <div class="nav-btn d-flex justify-content-end">
                        <!-- <a class="btn btn-outline-main c-btn text-nowrap d-flex justify-content-center align-items-center" href="findEmoStrength1st.html">上一步</a> -->
                        <button type="button" class="ms-16 px-md-24 btn btn-outline-main-tint01 c-btn c-btn-outline-main-tint01 text-nowrap d-flex justify-content-center align-items-center" id="btnBack">上一步</button>
                        <button type="button" class="ms-16 px-md-24 btn btn-main c-btn text-nowrap d-flex justify-content-center align-items-center" id="btnNext">下一步
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <ul  class="ms-4 mt-12 mb-24 px-12 px-sm-0 text-gray-550 fs-7">
                <li class="d-sm-none mb-4">謝謝親愛的ＯＯ，</li>
                <li class="d-sm-none mb-4">真誠地感受自己的情緒。</li>
                <li class="d-none d-sm-block mb-4">謝謝親愛的ＯＯ，真誠地感受自己的情緒。</li>
                <li>接下來，想邀請你慢慢地潛入自己的情緒故事中，找尋自己情緒的源頭。</li>
            </ul>

            <form action="#" method="post">
                <!-- 第一題 -->
                <div class="container">
                    <div class="mb-24 row align-items-center">
                        <div class="col-md-8 col-lg-9 mb-24 mb-md-0 bg-main-tint03 rounded">
                            <label for="whatHappened" id="WhatHappenedLabel" class="py-12 px-4">
                                <p class="mb-8 text-main fw-500 fs-6">
                                    邀請你輕輕地闔上雙眼，在吸氣與吐氣之間，慢慢地回想，在感受到「 ＸＸ 、 ＸＸ 、 ＸＸ 」的情緒之前，發生了什麼事情呢？
                                </p>
                                <p class="text-gray-550 fs-7">
                                    請在下欄中，試著寫下你覺得可能是讓你有這些情緒的原因或是事情、背景故事等。
                                </p>
                            </label>
                            <textarea class="w-100 mb-12 p-12 border rounded border-gray-500 text-gray-900" id="whatHappened" name="whatHappened"></textarea>
                        </div>
                        <div class="col-md-4 col-lg-3 d-flex justify-content-md-end">
                            <img class="d-block" src="../assets/images/emoStory/lime-diving.svg" alt="a man is diving">
                        </div>
                    </div>
                </div>
            </form>

            <!-- 圖片引用來源 -->
            <div class="text-md-end mb-64 px-12 px-sm-0">
                <span class="text-gray-500 fs-11">
                    Illustration by <a class="link-gray-500" href="https://icons8.com/illustrations/author/iAdLsFJOKDrk" target="_blank">Tanya Krasutska</a> from <a class="link-gray-500" href="https://icons8.com/illustrations" target="_blank">Ouch!</a>
                </span>
            </div>
        </div>
    </main>

    <%- include('./layout/floatButton') -%>
    
    <%- include('./layout/footer'); -%>

    <%- include('./layout/baseJs'); -%>
    <script type="text/javascript" src="../assets/js/textarea.js"></script>
    <script>
        const btnBack = document.querySelector('#btnBack');
        const btnNext = document.querySelector('#btnNext');
        const WhatHappenedLabel = document.querySelector('#WhatHappenedLabel');
        const whatHappened = document.querySelector('#whatHappened');
        const tooltips = document.querySelectorAll('#tooltip');
        // 預防頁面跳轉
        window.onbeforeunload = function () {
            return "Are you really sure?";
        }
        tooltips.forEach(function(tooltip, i){
            tooltip.addEventListener('click',function(){
                window.onbeforeunload = false;
            })
        })
        // 取得local storage 資料
        let storageData;
        let storageCards;
        let getAddedCards = localStorage.getItem("addedCards");
        storageData=JSON.parse(getAddedCards);
        storageCards=storageData[0].cards;

        // 確認 有無 whatHappened 的資料，有的話寫入textarea
        if(storageData.length>1){
            if(storageData[1].whatHappened!=""||storageData[1].whatHappened!=undefined){
                whatHappened.value=storageData[1].whatHappened;
            }
        }

        // 將情緒名詞寫入文句中
        axios.get("https://api.wavemocards.com/emoinfo/cards/")
        .then(function(response){
            let aryData = Object.values(response.data);
            let strLabel = "";
            let cardsNum = storageCards.length;
            let cardNames = [];
            storageCards.forEach(function(card, i){
                cardNames.push(card.name);
            })
            if(cardsNum==1){
                strLabel = `
                <p class="mb-8 text-main fw-500 fs-6">
                    邀請你輕輕地闔上雙眼，在吸氣與吐氣之間，慢慢地回想，在感受到「<span class="px-2">${cardNames[0]}</span>」的情緒之前，發生了什麼事情呢？
                </p>
                <p class="text-gray-550 fs-7">
                    請在下欄中，試著寫下你覺得可能是讓你有這些情緒的原因或是事情、背景故事等。
                </p>`;
            } else if (cardsNum==2){
                strLabel = `
                <p class="mb-8 text-main fw-500 fs-6">
                    邀請你輕輕地闔上雙眼，在吸氣與吐氣之間，慢慢地回想，在感受到「<span class="px-2">${cardNames[0]}</span>、<span class="px-2">${cardNames[1]}</span>」的情緒之前，發生了什麼事情呢？
                </p>
                <p class="text-gray-550 fs-7">
                    請在下欄中，試著寫下你覺得可能是讓你有這些情緒的原因或是事情、背景故事等。
                </p>`;
            } else {
                strLabel = `
                <p class="mb-8 text-main fw-500 fs-6">
                    邀請你輕輕地闔上雙眼，在吸氣與吐氣之間，慢慢地回想，在感受到「<span class="px-2">${cardNames[0]}</span>、<span class="px-2">${cardNames[1]}</span>、<span class="px-2">${cardNames[2]}</span>」的情緒之前，發生了什麼事情呢？
                </p>
                <p class="text-gray-550 fs-7">
                    請在下欄中，試著寫下你覺得可能是讓你有這些情緒的原因或是事情、背景故事等。
                </p>`;
            }
            WhatHappenedLabel.innerHTML = strLabel;
        })
        // 點擊上一步時，將資料寫入local storage中
        btnBack.addEventListener("click", function(){
            let value = whatHappened.value;
            if(storageData[1]==undefined){
                storageData.push({whatHappened:value});
            } else {
                storageData[1].whatHappened=value;
            }
            let stringAddedCard = JSON.stringify(storageData);
            localStorage.setItem("addedCards", stringAddedCard);
            window.onbeforeunload = false;
            location.href = "findEmoStrength1st.html";
        })
        // 點擊下一步時，將資料寫入 local storage中
        btnNext.addEventListener("click", function(){
            let value = whatHappened.value;
            if(storageData[1]==undefined){
                storageData.push({whatHappened:value});
            } else {
                storageData[1].whatHappened=value;
            }
            let stringAddedCard = JSON.stringify(storageData);
            localStorage.setItem("addedCards", stringAddedCard);
            window.onbeforeunload = false;
            location.href = "findEmoAction.html";
        })
        
    </script>
  </body>
</html>